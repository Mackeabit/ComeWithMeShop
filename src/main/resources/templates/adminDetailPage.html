<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/core-img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/core-img/favicon.ico">
  <title>
    Come With Me | Admin Members Manage
  </title>


<!--  <link rel="canonical" href="https://www.creative-tim.com/product/material-dashboard-pro" />-->

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />

  <link href="/admin/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="/admin/assets/css/nucleo-svg.css" rel="stylesheet" />

  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

  <link id="pagestyle" href="/admin/assets/css/material-dashboard.min.css" rel="stylesheet" />
  <!-- 제이쿼리 -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <!-- 카카오 주소 API -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

</head>
<body class="g-sidenav-show bg-gray-200">
<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark" id="sidenav-main">
  <div class="sidenav-header">
    <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
    <a class="navbar-brand m-0" href="/admin">
      <img src="/img/core-img/favicon.ico" class="navbar-brand-img h-100" alt="main_logo">
      <span class="ms-1 font-weight-bold text-white">Come With Me</span>
    </a>
  </div>
  <hr class="horizontal light mt-0 mb-2">
  <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">dashboard</i>
          </div>
          <span class="nav-link-text ms-1">Dash board</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white active bg-gradient-primary" href="/admin/members">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">person</i>
          </div>
          <span class="nav-link-text ms-1">회원 관리</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin/productReg">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">receipt_long</i>
          </div>
          <span class="nav-link-text ms-1">상품 등록</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin/productsList">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">checklist</i>
          </div>
          <span class="nav-link-text ms-1">상품 목록</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin/ordersList">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">view_list</i>
          </div>
          <span class="nav-link-text ms-1">주문 목록</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin/paymentsList">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">payments</i>
          </div>
          <span class="nav-link-text ms-1">결제 목록</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin/qnaList">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">rate_review</i>
          </div>
          <span class="nav-link-text ms-1">문의 목록</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="/admin/couponList">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">layers</i>
          </div>
          <span class="nav-link-text ms-1">쿠폰 관리</span>
        </a>
      </li>
    </ul>
  </div>
  <div class="sidenav-footer position-absolute w-100 bottom-0 ">
    <div class="mx-3">
      <a class="btn bg-gradient-primary mt-4 w-100" href="/admin/adminSign" type="button" th:if="${session.superAdmin != null}">계정 관리</a>
      <a class="btn bg-gradient-success mt-4 w-100" href="/admin/adminLogOut" type="button">로그아웃</a>
    </div>
  </div>
</aside>
<main class="main-content max-height-vh-100 h-100">
  <!-- Navbar -->
  <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl position-sticky blur shadow-blur mt-4 left-auto top-1 z-index-sticky" id="navbarBlur" data-scroll="true" checked>
    <div class="container-fluid py-1 px-3">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
          <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="/admin">Pages</a></li>
          <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="/admin/members">회원 관리</a></li>
          <li class="breadcrumb-item text-sm text-dark active" aria-current="page">회원 정보</li>
        </ol>
        <h6 class="font-weight-bolder mb-0">회원 정보</h6>
      </nav>
      <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
        <div class="ms-md-auto pe-md-3 d-flex align-items-center">
          <div class="input-group input-group-outline">
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- End Navbar -->
  <div class="container-fluid mt-4">
    <div class="row align-items-center">
      <div class="col-lg-9 mt-lg-0 mt-4">

        <div class="card card-body" id="profile">
          <div class="row justify-content-center align-items-center">
<!--
            <div class="col-sm-auto col-4">
              <div class="avatar avatar-xl position-relative">
              </div>
            </div>
-->
            <div class="col-sm-auto col-8 my-auto">
              <div class="h-100">
                <h5 class="mb-1 font-weight-bolder" th:text="${memberInfo.email}">
                  thdrudgh7775@naver.com
                </h5>
                <p class="mb-0 font-weight-normal text-sm" th:text="${memberInfo.grade_code} == 0 ? 'NORMAL':
                            (${memberInfo.grade_code} == 1 ? 'SILVAR':
                             (${memberInfo.grade_code == 2} ? 'GOLD': (${memberInfo.grade_code == 3} ? 'VIP' : 'UNKNOWN')))">
                </p>
              </div>
            </div>
            <div class="col-sm-auto ms-sm-auto mt-sm-0 mt-3 d-flex">
              <label class="form-check-label mb-0">
              </label>
            </div>
          </div>
        </div>

        <form id="changeInfoForm">
          <input type="hidden" name="member_idx" th:value="${memberInfo.member_idx}">
        <div class="card mt-4" id="basic-info">
          <div class="card-header">
            <h5>기본 정보</h5>
          </div>
          <div class="card-body pt-0">
            <div class="row">
              <div class="col-6">
                <div class="input-group input-group-static">
                  <label>Email</label>
                  <input id="email" name="email" type="email" class="form-control" placeholder="변경이 필요할 시 작성해주세요." autocomplete="off">
                </div>
              </div>
              <div class="col-6">
                <div class="input-group input-group-static">
                  <label>Confirm Email</label>
                  <input type="email" name="email_ck" class="form-control" th:value="${memberInfo.email_ck} == -1 ? '미인증':'인증 완료'" disabled>
                </div>
              </div>
            </div>
            <div class="row mt-4">
            </div>
            <div class="row mt-4">
              <div class="col-6">
                <div class="input-group input-group-static">
                  <label>주소</label>
                  <input id="street_address" oninput="send();" type="text" name="address" class="form-control" th:value="${memberInfo.address}" autocomplete="off" placeholder="주소">
                </div>
              </div>
              <div class="col-6">
                <div class="input-group input-group-static">
                  <label>상세 주소</label>
                  <input id="street_address2" type="text" name="address_detail" class="form-control" th:value="${memberInfo.address_detail}" autocomplete="off" placeholder="상세주소">
                </div>
              </div>
            </div>
            <div class="row" style="margin-top: 30px;">
              <div class="col-6">
                <div class="input-group input-group-static">
                  <label>우편 번호</label>
                  <input id="postcode" type="number" name="post_code" class="form-control" placeholder="우편 번호" th:value="${memberInfo.post_code}" readonly>
                </div>
              </div>
              <div class="col-6">
                <div class="input-group input-group-static">
                  <label>가입 날짜</label>
                  <input type="text" class="form-control" th:value="${memberInfo.sign_date}" disabled>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card mt-4" id="password">
          <div class="card-header">
            <h5>사용자 비밀번호 변경</h5>
          </div>
          <div class="card-body pt-0">
            <div class="input-group input-group-outline">
              <label class="form-label">New password</label>
              <input id="pwd" name="pwd" type="password" class="form-control" autocomplete="off">
            </div>
            <div class="input-group input-group-outline my-4">
              <label class="form-label">Confirm New password</label>
              <input id="pwd_check" type="password" class="form-control" autocomplete="off">
            </div>
            <h5 class="mt-5">비밀 번호 설정시 주의점</h5>
            <p class="text-muted mb-2">
              Please follow this guide for a strong password:
            </p>
            <ul class="text-muted ps-4 mb-0 float-start">
              <li>
                <span class="text-sm">기본적으로 회원의 요청이 있을 때만 변경해야 합니다.</span>
              </li>
              <li>
                <span class="text-sm">하나 이상의 특수 문자 사용하기</span>
              </li>
              <li>
                <span class="text-sm">최소 6자리의 비밀번호를 사용하기</span>
              </li>
              <li>
                <span class="text-sm">숫자를 최소 2가지 이상 사용하기</span>
              </li>
              <li>
                <span class="text-sm">비밀번호 자주 바꿔주기</span>
              </li>
            </ul>
            <button type="button" id="update_btn" class="btn bg-gradient-dark btn-sm float-end mt-6 mb-0">Update Information</button>
          </div>
        </div>
        </form>


        <script th:inline="javascript">

          /* 비밀 번호 체크용 */
          let add_ck = true;
          $('#pwd_check').focusout(function (){
            let pwd = $('#pwd').val();
            let pwd_check = $('#pwd_check').val();

            if (pwd == pwd_check) {
              add_ck = true;
            }else {
              add_ck = false;
              alert("비밀번호를 확인해주세요.");
            }

          });


          //주소입력칸을 클릭하면 발동
          document.getElementById("street_address").addEventListener("click", function(){
            //카카오 지도 발생
            new daum.Postcode({
              oncomplete: function(data) { //선택시 입력값 세팅
                document.getElementById("postcode").value = data.zonecode;//우편번호
                document.getElementById("street_address").value = data.address; // 주소 넣기
                document.getElementById("street_address2").value = '';
                $('#street_address2').focus(); //상세입력 포커싱
              }
            }).open();
          });



          //상세주소에 글을 쓰려고 하면 발동
          function send() {
            /* 카카오 주소 Api */
            new daum.Postcode({
              oncomplete: function(data) { //선택시 입력값 세팅
                document.getElementById("postcode").value = data.zonecode;//우편번호
                document.getElementById("street_address").value = data.address; // 주소 넣기
                document.getElementById("street_address2").value = '';
                $("#street_address2").focus(); //상세입력 포커싱
              }
            }).open();
          }


          /* 회원 정보 변경 시 */
          $('#update_btn').click(function () {


            if (!add_ck) {
              alert("비밀번호를 확인해주세요.");
              return false;
            }

            let email = $('#email').val();

            if (email != '') {
              const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
              if (!emailPattern.test(email)) {
                alert("이메일 주소를 확인해주세요.");
                return false;
              }
            }

            let formData = $('#changeInfoForm').serialize();

            alert(formData);


            $.ajax({
              type : "POST",
              url : "/admin/updateMembers",
              data : formData,
              success: function (data) {
                if(data == "no_email"){
                  alert("중복된 이메일 주소 입니다.");
                }else if(data == "Y"){
                  alert("수정이 완료되었습니다.");
                  location.href = "/admin/members";
                }
              },
              error: function(data){
                alert("잠시 후 재시도 해주세요.");
                console.log(data);
              }
            });



          });


        </script>


        <div class="card mt-4" id="sessions">
          <div class="card-header pb-3">
            <h5>최근 접속 이력</h5>
            <p class="text-sm">최근 접속한 로그인 날짜, 접속 IP 기록 입니다.</p>
          </div>
          <div class="card-body pt-0">
            <div class="d-flex align-items-center">
              <div class="text-center w-5">
                <i class="fas fa-desktop text-lg opacity-6"></i>
              </div>
              <div class="my-auto ms-3">
                <div class="h-100">
                  <p class="text-sm mb-1">
                    가장 최근에 접속한 IP 주소 입니다.
                  </p>
                  <p class="mb-0 text-xs" th:text="'IP Address : '+${memberLogList.get(0).login_ip}">
                    IP Address : 68.133.163.201
                  </p>
                </div>
              </div>
              <span class="badge badge-success badge-sm my-auto ms-auto me-3">Active</span>
            </div>
            <hr class="horizontal dark">
            <div class="d-flex align-items-center">
              <div class="text-center w-5">
                <i class="fas fa-desktop text-lg opacity-6"></i>
              </div>
              <div class="my-auto ms-3">
                <div class="h-100">
                  <p class="text-sm mb-1">
                    최근 로그인 날짜 입니다.
                  </p>
                  <p th:if="${memberInfo.login_date != null}" class="mb-0 text-xs" th:text="'Date : '+${#dates.format(memberInfo.login_date, 'yy/MM/dd')}">
                    로그인 날짜 :
                  </p>
                  <p th:if="${memberInfo.login_date == null}" class="mb-0 text-xs">
                    로그인 날짜 : 접속 이력이 없습니다.
                  </p>
                </div>
              </div>
              <span class="badge badge-success badge-sm my-auto ms-auto me-3">Active</span>
            </div>

            <!--
                        <div class="d-flex align-items-center">
                          <div class="text-center w-5">
                            <i class="fas fa-desktop text-lg opacity-6"></i>
                          </div>
                          <p class="my-auto ms-3" th:text="${#dates.format(memberInfo.login_date, 'yy/MM/dd')}">Chrome on macOS</p>
                        </div>
            -->
            <hr class="horizontal dark">
          </div>
        </div>

        <div class="card mt-4" id="delete">
          <div class="card-body">
            <div class="d-flex align-items-center mb-sm-0 mb-4">
              <div class="w-50">
                <h5>Delete Account</h5>
<!--                <p class="text-sm mb-0">Once you delete your account, there is no going back. Please be certain.</p>-->
                <p class="text-sm mb-0">현재 사용 중인 이메일 재사용이 불가하다는 것을 안내해야 합니다.</p>
              </div>
              <div class="w-50 text-end">
                <button id="delete_btn" class="btn bg-gradient-danger mb-0 ms-2" type="button" name="button">Delete Account</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <form id="deleteForm">
    <input type="hidden" name="member_idx" th:value="${memberInfo.member_idx}">
    </form>

    <script>

      $('#delete_btn').click(function () {

        let formData = $('#deleteForm').serialize();

        $.ajax({
          type : "POST",
          url : "/admin/deleteMembers",
          data : formData,
          success: function (data) {
            if(data == "N"){
              alert("계정 삭제에 실패하였습니다. 잠시 후 다시 시도해주세요.");
            }else if(data == "Y"){
              alert("계정이 삭제 되었습니다.");
              location.href = "/admin/members";
            }
          },
          error: function(data){
            alert("로그인 오류");
            console.log(data);
          }
        });

      });

    </script>

    <footer class="footer py-4  ">
      <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6 mb-lg-0 mb-4">
            <div class="copyright text-center text-sm text-muted text-lg-start">
              © <script>
              document.write(new Date().getFullYear())
            </script>,
              made with <i class="fa fa-heart"></i> by
              <a href="https://www.creative-tim.com" class="font-weight-bold">Creative Tim</a>
              for a better web.
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>
</main>

<script src="/admin/assets/js/core/popper.min.js"></script>
<script src="/admin/assets/js/core/bootstrap.min.js"></script>
<script src="/admin/assets/js/plugins/perfect-scrollbar.min.js"></script>
<script src="/admin/assets/js/plugins/smooth-scrollbar.min.js"></script>
<!--<script src="/admin/assets/js/plugins/choices.min.js"></script>-->

<!--<script src="/admin/assets/js/plugins/dragula/dragula.min.js"></script>-->
<!--<script src="/admin/assets/js/plugins/jkanban/jkanban.js"></script>-->

<script async defer src="https://buttons.github.io/buttons.js"></script>

<script src="/admin/assets/js/material-dashboard.min.js?v=3.0.6"></script>
</body>
</html>